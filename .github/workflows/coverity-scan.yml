name: cnc-sig-action
on:
  push:
    branches: [ main, master, develop, stage, release ]
  pull_request:
    branches: [ main, master, develop, stage, release ]
  workflow_dispatch:  
jobs:
  build:
    runs-on: self-hosted
    steps:
      #- name: Checkout Source
      #  uses: actions/checkout@v3
      
      #- name: Coverity Full Scan
      #  if: ${{ github.event_name != 'pull_request' }}
      #  uses: synopsys-sig/synopsys-action@v1.13.0
      #  with:
      #    coverity_url: https://synopsys-coverity-balwurk:8442/
      #    coverity_user: ${{ secrets.COVERITY_USER }}
      #    coverity_passphrase: ${{ secrets.COVERITY_PASSPHRASE }}
      #    coverity_project_name: webgoatcli
      #    coverity_stream_name: webgoatcli
      #    coverity_local: true


      - name: Run Cov-Format-Errors Command
        run: /home/azureuser/synopsys/cov-analysis/bin/cov-format-errors --dir /home/azureuser/capture/ --json-output-v7 /home/azureuser/capture/coverity-results.json
        shell: bash

      - name: Create SARIF file
        run: node cov-format-sarif-for-github.js --inputFile /home/azureuser/capture/coverity-results.json --outputFile /home/azureuser/capture/coverity-results_SARIF.json --githubUrl https://github.com --repoName testaccountcoverity/test --checkoutPath testaccountcoverity/test test/src 1212121212121212121212121212121212121212

      - name: Upload SARIF to GitHub
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: /home/azureuser/capture/coverity-results_SARIF.json

 
